<script src="/data/thumbnails.js"></script>
<script src="/data/screenXYZ.js"></script>
<!-- <script src ="/data/thumbnails_100.js"></script> -->
<script src="data/sphere_points.js"></script>
<script src="/node_modules/p5/lib/p5.js"></script>




<script>
    "use strict";

    let data;


    let thumbnail_array = Array(thumbnails.length);

    let y_rotate = 0;
    let x_rotate = 0;
    let z_rotate = 0;


    let records = Array();

    let background;


    function preload() {

        

       
        // for (let i = 0; i < 100; i++) {
        //     //LATER AANPASSEN NAAR data.length
        //     loadImage("data/" + data[i].thumbnail, img => {
        //             // data.thumbnail[i] = img;

        //     });
        // }


        console.log("preload done");
    }

    async function setup() {
        createCanvas(windowWidth, windowHeight, WEBGL);
        background = loadImage("/data/background.jpg");

        data = (await fetch("data/records.json").then(x => x.json())).media;

        
        // console.log(data);

        
        //LATER AANPASSEN NAAR data.length
        for (let i = 0; i < 100; i++) {
            thumbnail_array[i] = loadImage("data/"+data[i].thumbnail)
            let r = {
                "file": data[i].file,
                "ID": data[i].ID,
                "thumbnail": "data/" + data[i].thumbnail,
                "thumbnailwidth": data[i].thumbnailwidth,
                "thumbnailheight": data[i].thumbnailheight,
                "type": data[i].type,
                "width": data[i].width,
                "height": data[i].height,
                "tags": data[i].tags,
                "link": data[i].link,
                "brightness": data[i].brightness,
                "x": 0,
                "y": 0,
                "z": 0
            };
            records.push(r);
        }
        console.log("n records: " + records.length);

        textFont('Georgia');


        console.log("setup done");
    }


    async function draw() {

        image(background,-windowWidth/2 ,-windowHeight/2, windowWidth, windowHeight);

        let dim_x = windowWidth;
        let dim_y = windowHeight;
        let dim_z = dim_x;





        push();
        translate(-windowWidth/2, -windowHeight/2, -500);
        rotateY(y_rotate);
        rotateX(x_rotate);
        rotateZ(z_rotate);

        //Chaneg to data.length
        for (let i = 0; i < 100; i++) {
            let r = records[i];
            let p = sphere_points[i];
            let x = p[0] * dim_x;
            let y = p[1] * dim_y;
            let z = p[2] * dim_z;

            r.x = _screenX(x, y, z);
            r.y = _screenY(x, y, z);
            // r.z = _screenZ(x, y, z);
        

            point(p[0] * dim_x, p[1] * dim_y, p[2] * dim_z);
            // image(thumbnail_array[i],_screen_X,_screen_Y)


        }


        pop();

        noStroke();
        for (let i = 0; i < records.length; i++) {
            let r = records[i];
            image(thumbnail_array[i],r.x,r.y);
            // rect(r.x, r.y, 76, 30);
        }


        fill(255);
        // text(""+frameRate(), 20, 20);
        // console.log(frameRate());


        x_rotate += 0.0005;
        y_rotate += 0.0005;
        z_rotate += 0.0005;

    }

    function windowResized() {
        resizeCanvas(windowWidth, windowHeight);
    }

    function drawRecord(record, x, y) {
        // image
        // label
    }
</script>

<button class="btnbright" type="button">brightness</button>
<button class="btnsize" type="button">size</button>

<style>
    .record {
        position: fixed;
        width: 100px;
        height: 100px;
        background-color: red;
        stroke: black;
    }

    img {
        width: 100px;
        height: 100px;
    }
</style>